<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>MÃ©tÃ©o -
			{{ city ? city : 'Entrez une ville' }}</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="css/styles.css">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
	<!-- Leaflet CSS -->
	</head>
	<body>
		<!--*************** Mon HEADER **************************************************-->
		<header class="header-meteo text-center">
			<h1>ğŸŒ MÃ©tÃ©o en Direct</h1>
			<p>PrÃ©visions prÃ©cises pour votre ville</p>
		</header>
		<!--****************** titre dyn pour demander et afficher ville *****************-->
		<div class="container my-4">
			<h1 class="text-center mb-4">
				{% if city %}
					ğŸŒ¤ï¸ MÃ©tÃ©o pour
					{{ city }}
				{% else %}
					ğŸŒ¤ï¸ Entrez une ville pour voir la mÃ©tÃ©o
				{% endif %}
			</h1>

			<!-- Message d'erreur si la ville est invalide -->
			{% if errorMessage %}
				<div class="alert alert-danger text-center mb-4">
					{{ errorMessage }}
				</div>
			{% endif %}

			<!-- ğŸ” FORMULAIRE DE RECHERCHE -->
			<form method="get" class="search-form">
				<div class="search-wrapper">
					<input type="text" id="city-search" name="city" class="form-control"
					 placeholder="Entrez une ville, pays" 
					 value="{{ city }}" 
					 pattern="^[A-Za-zÃ€-Ã¿\s\-]+,\s*[A-Za-zÃ€-Ã¿\s\-]+$"
					 oninput="this.value = this.value.toLowerCase().replace(/[^A-Za-zÃ€-Ã¿\s-]/g, '').replace(/^./, c => c.toUpperCase())">
					<div id="suggestions-container"></div>
				</div>

				<!-- Bouton placÃ© sous l'input -->
				<div class="button-wrapper">
					<button type="submit" class="btn btn-primary">Rechercher</button>
				</div>
			</form>

			{% if weather is not null %}
				<div
					class="row">
					<!-- Informations principales ********************************-->
					<div class="col-md-6">
						<div class="card">
							<div class="card-body text-center">
								<h4 class="card-title">{{ weather.location.name }},
									{{ weather.location.country }}</h4>
								<p class="text-muted">{{ weather.location.region }}
									-
									{{ weather.location.tz_id }}</p>
								<p>
									<strong>Latitude:</strong>
									{{ weather.location.lat }}Â° -
									<strong>Longitude:</strong>
									{{ weather.location.lon }}Â°</p>
								<p id="live-clock" data-timezone="{{ weather.location.tz_id }}" class="fw-bold" style="font-size: 1.5rem;"></p>
								<img src="https:{{ weather.current.condition.icon }}" alt="{{ weather.current.condition.text }}">
								<h5 class="mt-2">{{ weather.current.condition.text }}</h5>
								<p>
									<strong>TempÃ©rature :</strong>
									{{ weather.current.temp_c }}Â°C (Ressentie :
									{{ weather.current.feelslike_c }}Â°C)</p>
								<br>
								<p>
									<strong>Lever du soleil :</strong>
									{{ weather.forecast.forecastday[0].astro.sunrise | date('H:i') }}</p>
								<p>
									<strong>Coucher du soleil :</strong>
									{{ weather.forecast.forecastday[0].astro.sunset | date('H:i') }}</p>
							</div>
						</div>
					</div>

					<!-- DÃ©tails mÃ©tÃ©o ***********************************************-->
					<div class="col-md-6">
						<div class="card">
							<div class="card-body">
								<h5 class="card-title">DÃ©tails mÃ©tÃ©o</h5>
								<ul class="list-group list-group-flush">
									<li class="list-group-item">ğŸ’¨
										<strong>Vent :</strong>
										{{ weather.current.wind_kph }}
										km/h 
																				                            ({{ (weather.current.wind_kph / 1.852)|round(1) }}
										nÅ“uds,
										{{ (weather.current.wind_kph / 3.6)|round(1) }}
										m/s) -
										{{ weather.current.wind_dir }}
										({{ weather.current.wind_degree }}Â°)</li>
									<li class="list-group-item">ğŸŒ¬ï¸
										<strong>Rafales :</strong>
										{{ weather.current.gust_kph }}
										km/h 
																				                            ({{ (weather.current.gust_kph / 1.852)|round(1) }}
										nÅ“uds,
										{{ (weather.current.gust_kph / 3.6)|round(1) }}
										m/s)</li>
									<li class="list-group-item">ğŸŒ¡ï¸
										<strong>Pression :</strong>
										{{ weather.current.pressure_mb }}
										hPa</li>
									<li class="list-group-item">ğŸ’§
										<strong>HumiditÃ© :</strong>
										{{ weather.current.humidity }}%</li>
									<li class="list-group-item">ğŸŒ«ï¸
										<strong>Point de rosÃ©e :</strong>
										{{ weather.current.dewpoint_c }}Â°C</li>
									<li class="list-group-item">â˜”
										<strong>PluviomÃ©trie :</strong>
										{{ weather.current.precip_mm }}
										mm</li>
									<li class="list-group-item">ğŸ‘€
										<strong>VisibilitÃ© :</strong>
										{{ weather.current.vis_km }}
										km</li>
									<li class="list-group-item">â˜€ï¸
										<strong>Indice UV :</strong>
										{{ weather.current.uv }}</li>
									<li class="list-group-item">ğŸ•°ï¸
										<strong>DerniÃ¨re mise Ã  jour :</strong>
										{{ weather.current.last_updated }}</li>
								</ul>
							</div>
						</div>
					</div>

					<!--***************** ğŸ“ Carte interactive Leaflet ************************************-->
					<h3 class="mt-4">La map:</h3>
					<div id="map" data-lat="{{ weather.location.lat }}" data-lon="{{ weather.location.lon }}" data-city="{{ weather.location.name }}" style="height: 400px; width: 100%; margin-top: 20px;"></div>

					<!--**************** Ã‰volution du temps heure par heure ********************-->
					<h3 class="mt-4">Choix 1: Ã‰volution du temps heure par heure</h3>
					<canvas id="hourlyWeatherChart"></canvas>

					<script>
						var hourlyData = {{ weather.forecast.forecastday[0].hour | json_encode() | raw }};
					</script>

					<!-- ğŸ“Š Tableau d'Ã©volution mÃ©tÃ©o heure par heure -->
					<h3 class="mt-4">Choix 2: Ã‰volution du temps heure par heure</h3>
					<div class="table-responsive">
						<table class="table-data table-bordered text-center">
							<thead class="table-dark">
								<tr>
									<th class="sticky-column">Heure</th>
									{% for hour in weather.forecast.forecastday[0].hour %}
										<th>{{ hour.time | date('H:i') }}</th>
									{% endfor %}
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="sticky-column">
										<strong>TempÃ©rature (Â°C)</strong>
									</td>
									{% for hour in weather.forecast.forecastday[0].hour %}
										<td>{{ hour.temp_c }}Â°C</td>
									{% endfor %}
								</tr>
								<tr>
									<td class="sticky-column">
										<strong>Vent moyen</strong>
									</td>
									{% for hour in weather.forecast.forecastday[0].hour %}
										<td>
											{{ hour.wind_kph }}
											km/h
											<br>
											({{ (hour.wind_kph / 1.852)|round(1) }}
											nÅ“uds,
											{{ (hour.wind_kph / 3.6)|round(1) }}
											m/s)
										</td>
									{% endfor %}
								</tr>
								<tr>
									<td class="sticky-column">
										<strong>Rafales</strong>
									</td>
									{% for hour in weather.forecast.forecastday[0].hour %}
										<td>
											{{ hour.gust_kph }}
											km/h
											<br>
											({{ (hour.gust_kph / 1.852)|round(1) }}
											nÅ“uds,
											{{ (hour.gust_kph / 3.6)|round(1) }}
											m/s)
										</td>
									{% endfor %}
								</tr>
								<tr>
									<td class="sticky-column">
										<strong>Direction du vent</strong>
									</td>
									{% for hour in weather.forecast.forecastday[0].hour %}
										<td>{{ hour.wind_dir }}
											({{ hour.wind_degree }}Â°)</td>
									{% endfor %}
								</tr>
								<tr>
									<td class="sticky-column">
										<strong>Pression (hPa)</strong>
									</td>
									{% for hour in weather.forecast.forecastday[0].hour %}
										<td>{{ hour.pressure_mb }}
											hPa</td>
									{% endfor %}
								</tr>
								<tr>
									<td class="sticky-column">
										<strong>HumiditÃ© (%)</strong>
									</td>
									{% for hour in weather.forecast.forecastday[0].hour %}
										<td>{{ hour.humidity }}%</td>
									{% endfor %}
								</tr>
								<tr>
									<td class="sticky-column">
										<strong>PrÃ©cipitations (mm)</strong>
									</td>
									{% for hour in weather.forecast.forecastday[0].hour %}
										<td>{{ hour.precip_mm }}
											mm</td>
									{% endfor %}
								</tr>
								<tr>
									<td class="sticky-column">
										<strong>Nuages (%)</strong>
									</td>
									{% for hour in weather.forecast.forecastday[0].hour %}
										<td>{{ hour.cloud }}%</td>
									{% endfor %}
								</tr>
							</tbody>
						</table>
					</div>


					<!--**************** PrÃ©visions mÃ©tÃ©o (si disponibles) ********************-->
					{% if weather.forecast is defined %}
						<h2 class="text-center mt-4">PrÃ©visions (Aujourd'hui + 3 jours)</h2>
						<div class="row">
							{% for day in weather.forecast.forecastday %}
								<div
									class="col-12 col-md-6 col-lg-3 mb-4">
									<!-- 12 colonnes sur mobile, 6 sur tablette, 3 sur grand Ã©cran -->
									<div class="card">
										<div class="card-body text-center">
											<h5>{{ day.date | date('Y-m-d') | format_datetime(pattern="EEEE d MMMM", locale="fr") }}</h5>
											<img src="https:{{ day.day.condition.icon }}" alt="{{ day.day.condition.text }}">
											<p>{{ day.day.condition.text }}</p>
											<br>
											<p>
												<strong>Temp :
													{{ day.day.mintemp_c }}Â°C Min /
													{{ day.day.maxtemp_c }}Â°C Max</strong>
											</p>
										</div>
									</div>
								</div>
							{% endfor %}
						</div>
					{% endif %}
				{% else %}
					<p class="text-center text-muted">Veuillez entrer une ville pour voir les prÃ©visions mÃ©tÃ©o.</p>
				{% endif %}
			</div>


			<!--**************************** Footer ******************************* -->
			<footer class="footer-meteo text-center">
				<p>Powered by
					<a class="lien-footer" href="https://www.weatherapi.com/" title="Free Weather API" target="_blank">WeatherAPI.com</a>
				</p>
				<p>
					<a href="https://www.weatherapi.com/" title="Free Weather API" target="_blank">
						<img src="https://cdn.weatherapi.com/v4/images/weatherapi_logo.png" alt="Weather data by WeatherAPI.com">
					</a>
				</p>
				<p>CrÃ©e par moi</p>
			</footer>

			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
			<!--JS Bootstrap-->
			<script src="{{ asset('javascript/javascript.js') }}"></script>
			<!--Mon JS-->

			<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
			<!--Pour les graphs-->
			<script src="{{ asset('javascript/weather-chart.js') }}"></script>
			<!--Pour les graphs-->

			<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
			<!-- Leaflet JS -->
			<script src="{{ asset('javascript/leaflet.js') }}"></script><!--Mon JS leaflet--></body>
	</body>
</html>
